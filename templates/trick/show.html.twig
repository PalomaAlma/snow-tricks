{% extends 'base.html.twig' %}

{% block title %}Trick{% endblock %}

{% block main %}
    {% if user and trick.author is same as user %}
        <div class="fixed-top d-flex justify-content-end align-items-center mt-5 languette">
            <a href="{{ path('app_trick_edit', {'id': trick.id}) }}" class="text-warning deledit fs-3"><i
                        class="fa-solid fa-pencil"></i></a>

            {{ include('trick/_delete_form.html.twig') }}
        </div>
    {% endif %}
    <section id="up"
             class="banner"
             style="background-image: url('/images/{{ trick.banner }}');">
        {#        <img src="/images/{{ trick.banner }}" alt=""> #}
        <div class=" text-center">
            <h1 class="text-center">
                {{ trick.name }} | {{ trick.category }}
            </h1>
            <a href="#down" class="link-light fs-1"><i class="fa-solid fa-arrow-down fa-beat"></i></a>
        </div>
    </section>
    <section class="text-center my-4 mx-4" id="down">
        <div class="d-xl-flex justify-content-between">
            <div id="carouselMedia">
                <p>Cliquez sur chaque image pour la faire défiler</p>
                {% set i = 0 %}
                {% for media in trick.media %}
                    <div class="{% if i == 0 %}selected{% elseif i == 1 %}next{% elseif i == 2 %}nextRightSecond{% elseif i == 3 %}hideRight{% endif %}">
                        <img src="{{ asset('images/') }}{{ media.name }}"
                             alt="{{ media.name }}">
                        {% if user and trick.author is same as user %}
                            <div class="d-flex justify-content-end align-items-center">
                                {#                        <a href="{{ path('app_media_edit', {'id': media.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                {{ include('media/_delete_form.html.twig') }}
                            </div>
                        {% endif %}</div>
                    {% set i = i+1 %}
                {% endfor %}

            </div>
            <div id="carouselVideo">
                {% set i = 0 %}
                {% for video in trick.videos %}
                    <div class="{% if i == 0 %}selected{% elseif i == 1 %}next{% elseif i == 2 %}nextRightSecond{% elseif i == 3 %}hideRight{% endif %}">
                        {{ video.url|raw }}
                        {% if user and trick.author is same as user %}
                            <div class="d-flex justify-content-end align-items-center">
                                {#                        <a href="{{ path('app_media_edit', {'id': media.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                {{ include('video/_delete_form.html.twig') }}
                            </div>
                        {% endif %}</div>
                    {% set i = i+1 %}
                {% endfor %}

            </div>
        </div>

        <ul class="d-none justify-content-between d-none list-unstyled">
            <li class="">
                <ul class="d-flex justify-content-evenly list-unstyled">
                    {% for media in trick.media %}
                        <li class="list-inline-item"><img src="{{ asset('images/') }}{{ media.name }}"
                                                          alt="{{ media.name }}" class="img-fluid"
                                                          style="max-width: 15rem">
                            {% if user and trick.author is same as user %}
                                <div class="d-flex justify-content-end align-items-center">
                                    {#                        <a href="{{ path('app_media_edit', {'id': media.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                    {{ include('media/_delete_form.html.twig') }}
                                </div>
                            {% endif %}</li>
                    {% endfor %}
                </ul>
            </li>
            <li>
                <ul class="d-flex justify-content-evenly list-unstyled">
                    {% for video in trick.videos %}
                        <li class="list-inline-item">
                            {{ video.url|raw }}
                            {% if user and trick.author is same as user %}
                                <div class="d-flex justify-content-end align-items-center">
                                    {#                            <a href="{{ path('app_video_edit', {'id': video.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                    {{ include('video/_delete_form.html.twig') }}
                                </div>
                            {% endif %}</li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
        <!-- Button trigger modal -->
        <button type="button" class="btn d-xl-none" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Voir les médias
        </button>
        <!-- Scrollable modal -->
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">

                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                                    class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <ul class="list-unstyled">
                            <li class="">
                                <ul class="list-unstyled">
                                    {% for media in trick.media %}
                                        <li class="my-4"><img src="{{ asset('images/') }}{{ media.name }}"
                                                              alt="{{ media.name }}" class="img-fluid"
                                                              style="max-width: 15rem">
                                            {% if user and trick.author is same as user %}
                                                <div class="d-flex justify-content-end align-items-center">
                                                    {#                        <a href="{{ path('app_media_edit', {'id': media.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                                    {{ include('media/_delete_form.html.twig') }}
                                                </div>
                                            {% endif %}</li>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li>
                                <ul class="list-unstyled">
                                    {% for video in trick.videos %}
                                        <li class="my-4">
                                            {{ video.url|raw }}
                                            {% if user and trick.author is same as user %}
                                                <div class="d-flex justify-content-end align-items-center">
                                                    {#                            <a href="{{ path('app_video_edit', {'id': video.id}) }}" class="text-warning deledit"><i class="bi bi-pencil"></i></a> #}

                                                    {{ include('video/_delete_form.html.twig') }}
                                                </div>
                                            {% endif %}</li>
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="text-center fs-1">
        <p>{{ trick.description }}</p>
    </section>

    <section class="text-center">
        <ul class="list-inline">
            <li class="list-inline-item">Créé le {{ trick.createdAt|date("d/m/Y") }} par {{ trick.author }}</li>
            |
            <li class="list-inline-item">Mis à jour le {{ trick.updatedAt|date("d/m/Y") }}</li>
        </ul>
    </section>

    <a href="{{ path('app_trick_index', {'page':1}) }}" class="btn btn-lg m-4"><i
                class="fa-solid fa-arrow-left-long"></i></a>
    <hr>

    {% if user %}
        <form class="container" method="post">
            <label for="content" class="text-start my-4">Laisser un Commentaire</label>
            <textarea name="content" id="content" cols="30" rows="10" class="form-control"></textarea>
            <div class="w-100 text-end container my-4">
                <button type="submit" class="btn btn-primary ms-auto">Envoyer</button>
            </div>
        </form>
    {% endif %}

    <ul class="list-group container">
        {% for com in messages %}
            <li class="list-group-item py-4">
                <div class="fw-bold"> {{ com.author }}</div>
                <p>{{ com.content }}</p>
                <div class="fw-lighter text-muted d-flex justify-content-between flex-wrap">{{ com.createAt|date }}
                    <a href="" class="d-none">Signaler ce commentaire</a></div>
            </li>
        {% endfor %}
    </ul>
    {% if nbPages|length() > 1 %}
        <nav aria-label="Page navigation" class="pagination">
            <ul class="pagination">
                <li class="page-item"><a class="page-link secondary-link"
                                         href="/trick/{{ trick.id }}/page{% if page is same as(1) %}{{ page }}{% else %}{{ page -1 }}{% endif %}"><</a>
                </li>
                {% set k = 0 %}
                {% for k in 0..nbPages| number_format(0, '.', ',') %}
                    {% if k < nbPages %}
                        {% set k=k+1 %}
                        <li class="page-item"><a class="page-link {% if k is same as(page) %}active{% endif %}"
                                                 href="/trick/{{ trick.id }}/page{{ k }}">{{ k }}</a></li>
                    {% endif %}
                {% endfor %}
                <li class="page-item"><a class="page-link secondary-link"
                                         href="/trick/{{ trick.id }}/page{% if page > nbPages|length() %}{{ page }}{% else %}{{ page + 1 }}{% endif %}">></a>
                </li>
            </ul>
        </nav>
    {% endif %}

{% endblock %}

{% block express_js %}
    <script>

        function moveToSelected(element) {
            if (element == "next") {
                var selected = $(".selected").next();
            } else if (element == "prev") {
                var selected = $(".selected").prev();
            } else {
                var selected = element;
            }

            var next = $(selected).next();
            var prev = $(selected).prev();
            var prevSecond = $(prev).prev();
            var nextSecond = $(next).next();

            $(selected).removeClass().addClass("selected");

            $(prev).removeClass().addClass("prev");
            $(next).removeClass().addClass("next");

            $(nextSecond).removeClass().addClass("nextRightSecond");
            $(prevSecond).removeClass().addClass("prevLeftSecond");

            $(nextSecond).nextAll().removeClass().addClass('hideRight');
            $(prevSecond).prevAll().removeClass().addClass('hideLeft');

        }

        // Eventos teclado
        $(document).keydown(function (e) {
            switch (e.which) {
                case 37: // left
                    moveToSelected('prev');
                    break;

                case 39: // right
                    moveToSelected('next');
                    break;

                default:
                    return;
            }
            e.preventDefault();
        });

        $('#carouselMedia div, #carouselVideo div').click(function () {
            console.log('ok')
            moveToSelected($(this));
        });

        $('#prev').click(function () {
            console.log('ok')
            moveToSelected('prev');
        });

        $('#next').click(function () {
            console.log('ok')
            moveToSelected('next');
        });

    </script>
{% endblock %}
